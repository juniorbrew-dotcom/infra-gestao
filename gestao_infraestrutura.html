<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Gestão de Infraestrutura</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>

<h1>Gestão de Infraestrutura</h1>

<!-- Menu Principal -->
<div id="secao-menu" class="section">
  <h2>Menu Principal</h2>
  <button onclick="mostrarSecao('clientes')">📇 Clientes</button>
  <button onclick="mostrarSecao('responsaveis')">👤 Responsáveis</button>
  <button onclick="mostrarSecao('tipos')">🗂️ Tipos de Tarefa</button>
  <button onclick="mostrarSecao('tarefas')">📋 Tarefas</button>
</div>

<!-- Seção: Clientes -->
<div id="secao-clientes" class="section hidden">
  <h2>Cadastro de Clientes</h2>
  <button onclick="mostrarSecao('menu')">🏠 Home</button>
  <form id="clienteForm">
    <label>Razão Social:</label>
    <input type="text" id="razaoSocial" required>

    <label>CNPJ:</label>
    <input type="text" id="cnpj" required maxlength="18" placeholder="00.000.000/0000-00">

    <label>Telefone:</label>
    <input type="text" id="telefone" required>

    <label>E-mail:</label>
    <input type="email" id="email" required>

    <button type="submit">➕ Incluir Cliente</button>
  </form>

  <table id="tabelaClientes">
    <thead>
      <tr>
        <th>Razão Social</th>
        <th>CNPJ</th>
        <th>Telefone</th>
        <th>E-mail</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Seção: Responsáveis -->
<div id="secao-responsaveis" class="section hidden">
  <h2>Cadastro de Responsáveis</h2>
  <button onclick="mostrarSecao('menu')">🏠 Home</button>
  <form id="responsavelForm">
    <label>Nome:</label>
    <input type="text" id="nomeResponsavel" required>

    <label>Função:</label>
    <input type="text" id="funcaoResponsavel" required>

    <label>Telefone:</label>
    <input type="text" id="telefoneResponsavel" required>

    <label>E-mail:</label>
    <input type="email" id="emailResponsavel" required>

    <button type="submit">➕ Incluir Responsável</button>
  </form>

  <table id="tabelaResponsaveis">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Função</th>
        <th>Telefone</th>
        <th>E-mail</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Seção: Tipos de Tarefa -->
<div id="secao-tipos" class="section hidden">
  <h2>Cadastro de Tipos de Tarefa</h2>
  <button onclick="mostrarSecao('menu')">🏠 Home</button>
  <form id="tipoForm">
    <label>Nome do Tipo de Tarefa:</label>
    <input type="text" id="nomeTipo" required>

    <label>Checklist (um item por linha):</label>
    <textarea id="checklistTipo" rows="5" placeholder="Ex: Verificar tomadas\nTestar disjuntores"></textarea>

    <button type="submit">➕ Incluir Tipo</button>
  </form>

  <table id="tabelaTipos">
    <thead>
      <tr>
        <th>Tipo</th>
        <th>Checklist</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Seção: Tarefas -->
<div id="secao-tarefas" class="section hidden">
  <h2>Agenda de Tarefas</h2>
  <button onclick="mostrarSecao('menu')">🏠 Home</button>
  <form id="tarefaForm">
    <label>Tarefa:</label>
    <input type="text" id="tarefa" required>

    <label>Responsável:</label>
    <select id="responsavelSelect" required>
      <option value="">Selecione um responsável</option>
    </select>

    <label>Cliente:</label>
    <select id="clienteSelect" required>
      <option value="">Selecione um cliente</option>
    </select>

    <label>Tipo de Tarefa:</label>
    <select id="tipoSelect" required onchange="mostrarChecklistTipo()">
      <option value="">Selecione o tipo</option>
    </select>

    <div id="checklistPreview" class="section hidden">
      <h3>Checklist do Tipo Selecionado</h3>
      <ul id="checklistItens"></ul>
    </div>

    <button type="submit">➕ Incluir Tarefa</button>
  </form>

  <label for="filtroCliente"><strong>Filtrar tarefas por cliente:</strong></label>
  <select id="filtroCliente">
    <option value="">Todos os clientes</option>
  </select>

  <button onclick="exportarPDF()">📄 Exportar Tarefas para PDF</button>
  <button onclick="limparDados()">🧹 Limpar Todos os Dados</button>

  <div id="tarefaContainer">
    <table id="taskTable">
      <thead>
        <tr>
          <th>Tarefa</th>
          <th>Responsável</th>
          <th>Cliente</th>
          <th>Tipo</th>
          <th>Status</th>
          <th>Checklist</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script src="script.js"></script>
// script.js

// Variáveis globais
const tabelaClientes = document.getElementById('tabelaClientes').getElementsByTagName('tbody')[0];
const tabelaResponsaveis = document.getElementById('tabelaResponsaveis').getElementsByTagName('tbody')[0];
const tabelaTipos = document.getElementById('tabelaTipos').getElementsByTagName('tbody')[0];
const taskTable = document.getElementById('taskTable').getElementsByTagName('tbody')[0];

const clienteSelect = document.getElementById('clienteSelect');
const responsavelSelect = document.getElementById('responsavelSelect');
const tipoSelect = document.getElementById('tipoSelect');
const filtroCliente = document.getElementById('filtroCliente');

const checklistItens = document.getElementById('checklistItens');
const checklistPreview = document.getElementById('checklistPreview');

const tiposDeTarefa = {};

// ------------------------- CLIENTES -------------------------
const clienteForm = document.getElementById('clienteForm');
clienteForm.addEventListener('submit', function (e) {
  e.preventDefault();
  const editando = clienteForm.getAttribute('data-editando');
  const razao = document.getElementById('razaoSocial').value;
  const cnpjVal = document.getElementById('cnpj').value;
  const telefoneVal = document.getElementById('telefone').value;
  const emailVal = document.getElementById('email').value;

  if (!/^\d{2}\.\d{3}\.\d{3}\/\d{4}-\d{2}$/.test(cnpjVal)) {
    alert("CNPJ inválido. Use o formato 00.000.000/0000-00");
    return;
  }

  if (editando) {
    const linha = tabelaClientes.rows[editando];
    linha.cells[0].innerText = razao;
    linha.cells[1].innerText = cnpjVal;
    linha.cells[2].innerText = telefoneVal;
    linha.cells[3].innerText = emailVal;
  } else {
    const linha = tabelaClientes.insertRow();
    linha.insertCell(0).innerText = razao;
    linha.insertCell(1).innerText = cnpjVal;
    linha.insertCell(2).innerText = telefoneVal;
    linha.insertCell(3).innerText = emailVal;

    const acaoCell = linha.insertCell(4);
    const editarBtn = document.createElement('button');
    editarBtn.innerText = "✏️ Editar";
    editarBtn.onclick = () => editarCliente(linha);

    const excluirBtn = document.createElement('button');
    excluirBtn.innerText = "🗑️ Excluir";
    excluirBtn.onclick = () => {
      if (confirm("Deseja excluir este cliente?")) {
        linha.remove();
        atualizarSelects();
        salvarDados();
      }
    };

    acaoCell.appendChild(editarBtn);
    acaoCell.appendChild(excluirBtn);
  }

  clienteForm.reset();
  clienteForm.removeAttribute('data-editando');
  clienteForm.querySelector('button').innerText = "➕ Incluir Cliente";
  atualizarSelects();
  salvarDados();
});

function editarCliente(linha) {
  document.getElementById('razaoSocial').value = linha.cells[0].innerText;
  document.getElementById('cnpj').value = linha.cells[1].innerText;
  document.getElementById('telefone').value = linha.cells[2].innerText;
  document.getElementById('email').value = linha.cells[3].innerText;
  clienteForm.setAttribute('data-editando', linha.rowIndex);
  clienteForm.querySelector('button').innerText = "💾 Salvar Alterações";
}

// Máscara de CNPJ
document.getElementById('cnpj').addEventListener('input', function () {
  let v = this.value.replace(/\D/g, '');
  if (v.length > 14) v = v.slice(0, 14);
  v = v.replace(/^(\d{2})(\d)/, '$1.$2');
  v = v.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
  v = v.replace(/\.(\d{3})(\d)/, '.$1/$2');
  v = v.replace(/(\d{4})(\d)/, '$1-$2');
  this.value = v;
});

</body>
</html>
